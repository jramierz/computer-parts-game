:root {
  --bg: #f7fbff;
  --ink: #0f172a;
  --accent: #34d399;
}

/* Reset básico */
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, Segoe UI, Arial, sans-serif;
  background: #f0f8ff;
  color: var(--ink);
  display: grid;
  min-height: 100dvh;
  place-items: center;
}

.wrap { width: min(1100px, 95vw); padding: 20px; }

h1 { text-align: center; margin: 0 0 12px; font-size: clamp(22px, 3.2vw, 32px); }
p.tip { text-align: center; margin: 0 0 22px; opacity: .75; }

/* Grid de tarjetas */
.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: clamp(12px, 2.5vw, 24px);
  justify-items: stretch;
  will-change: transform;
}
@media (max-width: 780px) {
  .grid { grid-template-columns: 1fr; }
}

/* Tarjeta + área de click */
.card {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: stretch;
  overflow: hidden;
  background: #fff;
  border-radius: 16px;
  border: 4px solid #e0ecff;
  box-shadow: 0 8px 24px rgba(0,0,0,.08);
  padding: clamp(12px, 2.2vw, 20px);
  isolation: isolate;
  transition: box-shadow .2s ease;
}
.card:hover { box-shadow: 0 10px 25px rgba(0,0,0,.15); }

.hit {
  width: 100%;
  min-width: 0;
  margin: 0;
  display: grid;
  place-items: center;
  gap: 12px;
  border: 3px solid transparent;
  border-radius: 14px;
  padding: clamp(10px, 2vw, 16px);
  cursor: pointer;
  outline: none;
  transition: transform .08s ease, border-color .12s ease, box-shadow .12s ease;
}
.hit:hover { transform: translateY(-2px); }
.hit:focus-visible {
  border-color: var(--accent);
  box-shadow: 0 0 0 4px color-mix(in srgb, var(--accent) 30%, transparent);
}
.hit:active img { transform: scale(1.06); transition: transform .1s; }

.img {
  width: min(220px, 60vw);
  max-width: 100%;
  aspect-ratio: 1 / 1;
  display: block;
  object-fit: contain;
  user-select: none;
  -webkit-user-drag: none;
  pointer-events: none;
}

.label {
  font-weight: 700;
  font-size: clamp(18px, 2.4vw, 22px);
  color: #111;
  text-shadow: 1px 1px 2px rgba(0,0,0,.1);
}

/* Burbuja de “tocado” */
.bubble {
  position: absolute; inset: auto 12px 12px auto;
  background: #000; color: #fff; font-weight: 700;
  padding: 6px 10px;
  border-radius: 999px;
  opacity: 0; transform: translateY(6px);
  transition: opacity .12s, transform .12s;
  pointer-events: none;
}
.card.flash .bubble { opacity: 1; transform: translateY(0); }

/* Mascota, menú y globo */
.mascota {
  position: fixed; bottom: 20px; left: 20px; z-index: 60;
  transform: rotate(-8deg);
  animation: flotar 4s ease-in-out infinite;
  transition: transform .3s ease, scale .3s ease;
}
.mascota:hover { transform: rotate(-2deg) scale(1.05); }
.mascota img {
  width: 140px; user-select: none;
  filter: drop-shadow(0 5px 10px rgba(0,0,0,.2));
  pointer-events: auto;
}

/* Menú de burbujas */
.mascota-bubbles {
  position: absolute; left: 110px; bottom: 10px;
  display: grid; gap: 8px;
  opacity: 0; transform: translateY(8px) scale(.98);
  pointer-events: none; transition: opacity .18s, transform .18s;
  z-index: 2;
}
.mascota.open .mascota-bubbles { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }

.bubble-btn {
  border: 0; border-radius: 999px; padding: 10px 14px;
  background: #e2e8f0; color:#0f172a; font-weight: 800; cursor: pointer;
  box-shadow: 0 8px 16px rgba(0,0,0,.08);
}
.bubble-btn.primary { background: #34d399; color:#06331f; }

/* Globo de diálogo */
.mascota-say {
  position: absolute; left: 120px; bottom: 18px;
  max-width: min(520px, 85vw);
  background: #fff; border-radius: 18px; box-shadow: 0 12px 30px rgba(0,0,0,.15);
  border: 3px solid #dbeafe; padding: 10px 14px;
  transform-origin: left bottom;
  transform: translateY(8px) scale(.98);
  opacity: 0; pointer-events: none;
  transition: opacity .18s, transform .18s, border-color .18s, background .18s;
  z-index: 1;
}
.mascota-say::after {
  content: ""; position: absolute; left: -10px; bottom: 14px; width: 0; height: 0;
  border-top: 10px solid transparent;
  border-bottom: 10px solid transparent;
  border-right: 12px solid #fff;
  filter: drop-shadow(0 2px 0 rgba(0,0,0,.06));
}

/* Visibilidad del globo */
.mascota .mascota-say { opacity: 0; transform: translateY(8px) scale(.98); pointer-events: none; }
.mode-guided .mascota .mascota-say { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
.mode-guided .mascota.open .mascota-say { opacity: 0; transform: translateY(8px) scale(.98); pointer-events: none; }

.say-row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.dot { width: 12px; height: 12px; border-radius: 999px; flex: 0 0 12px; animation: pulse 1.4s ease-in-out infinite; }
@keyframes pulse { 0%,100%{ transform: scale(1); opacity:.9 } 50%{ transform: scale(1.2); opacity:1 } }

.say-text { font-weight: 800; color:#0f172a; font-size: clamp(14px, 2.1vw, 18px); }
.step-pill { margin-left: auto; background:#e2e8f0; color:#0f172a; font-weight: 800; border-radius: 999px; padding: 6px 10px; font-size: 12px; }

/* Estados del globo */
.mascota-say.is-ask   { border-color:#bfdbfe; background:#f8fbff; }
.mascota-say.is-ask .dot  { background:#3b82f6; }
.mascota-say.is-good  { border-color:#bbf7d0; background:#f4fff8; }
.mascota-say.is-good .dot { background:#22c55e; }
.mascota-say.is-error { border-color:#fecaca; background:#fff8f8; }
.mascota-say.is-error .dot { background:#ef4444; }

/* Feedback & transiciones */
.card.ok  { outline: 4px solid #34d399; transition: outline-color .2s; }
.card.err { outline: 4px solid #ef4444; animation: shake .45s linear 1; }

@keyframes shake {
  0%{transform: translateX(0)}
  25%{transform: translateX(-4px)}
  50%{transform: translateX(4px)}
  75%{transform: translateX(-3px)}
  100%{transform: translateX(0)}
}

.grid.slide { animation: slideSwap .45s ease both; }
@keyframes slideSwap { 0%{opacity:.2; transform: translateX(8px);} 100%{opacity:1; transform: translateX(0);} }

@keyframes flotar {
  0%,100% { transform: rotate(-8deg) translateY(0); }
  50%     { transform: rotate(-6deg) translateY(-10px); }
}

#guidedBar { display: none !important; }

/* Barajado (shuffle) */
.grid.shuf { animation: gridWiggle .25s ease; }
@keyframes gridWiggle {
  0%   { transform: scale(.98); opacity: .9; }
  100% { transform: scale(1);   opacity: 1;  }
}

/* Entrada “pop” por tarjeta durante el shuffle */
.grid.shuf .card {
  animation: popIn .30s ease both;
  box-shadow: 0 12px 24px rgba(0,0,0,.12);
}
@keyframes popIn {
  0%   { transform: translateY(8px) scale(.96) rotate(var(--r, 0deg)); opacity: 0; }
  60%  { opacity: 1; }
  100% { transform: none; opacity: 1; }
}
.grid.shuf .card:nth-child(3n+1) { --r: -3deg; }
.grid.shuf .card:nth-child(3n+2) { --r:  2.5deg; }
.grid.shuf .card:nth-child(3n+3) { --r: -1.5deg; }

.grid .card { transition: box-shadow .2s; }

/* Accesibilidad: menos movimiento */
@media (prefers-reduced-motion: reduce) {
  .grid.slide,
  .grid.shuf,
  .grid.shuf .card {
    animation: none !important;
    transition: none !important;
  }
}
